"use strict";Object.defineProperty(exports, "__esModule", {value: true});var _chunkEYEXIIFRcjs = require('./chunk-EYEXIIFR.cjs');var _chunk3YNQTTHIcjs = require('./chunk-3YNQTTHI.cjs');var _chunkFXVJCHR6cjs = require('./chunk-FXVJCHR6.cjs');var _nonsecure = require('nanoid/non-secure');var n=class n{constructor(t,e,s){this.clientId=t,this.clientSecret=e,this.test=s}static get(t,e,s=!1){return(!n.instance||n.instance.clientId!==t||n.instance.clientSecret!==e||n.instance.test!==s)&&(n.instance=new n(t,e,s)),n.instance}get store(){return new (0, _chunkEYEXIIFRcjs.a)(this)}get voting(){return new (0, _chunk3YNQTTHIcjs.a)(this)}async member(t){return _chunkFXVJCHR6cjs.a.fromObject(this,await this.post("community","/member/search",t))}async fetch(t,e,s){let o=this.test?"https://dev.serverbench.io":"https://api.beta.serverbench.io",i=new Headers({authorization:`ApiKey ${this.clientSecret}`});s&&i.set("Content-Type","application/json");let a=await fetch(`${o}/${t}/${this.clientId}${e}`,{headers:i,method:s?"POST":"GET",body:s?JSON.stringify(s):void 0});if(a.status<200||a.status>=300)throw new Error(a.statusText);return a.json()}rid(){return _nonsecure.nanoid.call(void 0, )}socket(t,e=o=>{},s=!1){let o=this.test?"ws://localhost:3030":"wss://live.beta.serverbench.io",i=new WebSocket(`${o}?${new URLSearchParams({key:this.clientSecret})}`),a=0,c=this.rid();return i.onopen=()=>{a=0,i.send(JSON.stringify({action:`community.${this.clientId}.${t}`,rid:c}))},i.onmessage=p=>{let r=JSON.parse(p.data);if(r.result!=null&&(Array.isArray(r.result)&&r.result.length||Object.keys(r.result).length>0)&&r.rid==c)e(r.result);else{let l=[r.realm];r.realm=="community"&&l.push(this.clientId),l.push(r.action),c=this.rid(),i.send(JSON.stringify({action:l.join("."),rid:c}))}},s||(i.onclose=()=>{a++,setTimeout(()=>{i=this.socket(t,e,!0).ws},Math.min(1e3*a*5,30*1e3))}),{dispose:()=>{i.onclose=null,i.close()},ws:i}}async get(t,e){return this.fetch(t,e)}async post(t,e,s={}){return this.fetch(t,e,s)}};n.instance=null;var h=n;exports.a = h;
//# sourceMappingURL=chunk-FIJDSJKB.cjs.map