import{a as m}from"./chunk-PYY2YREC.js";import{a as g}from"./chunk-CTMUE5H3.js";import{a as u}from"./chunk-GLEWOHG7.js";import{nanoid as d}from"nanoid/non-secure";var n=class n{constructor(t,s,i){this.clientId=t,this.clientSecret=s,this.test=i}static get(t,s,i=!1){return(!n.instance||n.instance.clientId!==t||n.instance.clientSecret!==s||n.instance.test!==i)&&(n.instance=new n(t,s,i)),n.instance}get store(){return new m(this)}get voting(){return new g(this)}async member(t){return u.fromObject(this,await this.post("community","/member/search",t))}get domain(){return this.test?"https://dev.serverbench.io":"https://api.beta.serverbench.io"}async fetch(t,s,i){let a=new Headers({authorization:`ApiKey ${this.clientSecret}`});i&&a.set("Content-Type","application/json");let e=await fetch(`${this.domain}/${t}/${this.clientId}${s}`,{headers:a,method:i?"POST":"GET",body:i?JSON.stringify(i):void 0});if(e.status<200||e.status>=300)throw new Error(e.statusText);return e.json()}rid(){return d()}socket(t,s=a=>{},i=!1){let a=this.test?"ws://localhost:3030":"wss://live.beta.serverbench.io",e=new WebSocket(`${a}?${new URLSearchParams({key:this.clientSecret})}`),c=0,o=this.rid();return e.onopen=()=>{c=0,e.send(JSON.stringify({action:`community.${this.clientId}.${t}`,rid:o}))},e.onmessage=p=>{let r=JSON.parse(p.data);if(r.result!=null&&(Array.isArray(r.result)&&r.result.length||Object.keys(r.result).length>0)&&r.rid==o)s(r.result);else{let l=[r.realm];r.realm=="community"&&l.push(this.clientId),l.push(r.action),o=this.rid(),e.send(JSON.stringify({action:l.join("."),rid:o}))}},i||(e.onclose=()=>{c++,setTimeout(()=>{e=this.socket(t,s,!0).ws},Math.min(1e3*c*5,30*1e3))}),{dispose:()=>{e.onclose=null,e.close()},ws:e}}async get(t,s){return this.fetch(t,s)}async post(t,s,i={}){return this.fetch(t,s,i)}};n.instance=null;var h=n;export{h as a};
//# sourceMappingURL=chunk-AB2ET2EM.js.map