{"version":3,"sources":["../src/store/Store.ts"],"sourcesContent":["import Element from \"../element/Element.js\";\nimport Member from \"../Member.js\";\nimport type Serverbench from \"../Serverbench.js\";\nimport IDiscount from \"./IDiscount.js\";\nimport ISkuPrice from \"./ISkuPrice.js\";\nimport StoreDisplay from \"./StoreDisplay.js\";\n\nexport default class Store {\n\n    private client: Serverbench\n\n    constructor(client: Serverbench) {\n        this.client = client\n    }\n\n    async get(username?: string, eid?: string) {\n        return StoreDisplay.fromObject(this.client, await this.client.post('community', '/store/view', {\n            username,\n            eid\n        }))\n    }\n\n    async subscriptionCount() {\n        const { count } = await this.client.get('community', '/subscription/count')\n        return count\n    }\n\n    checkout(prices: ISkuPrice[] | string[], discounts: IDiscount[] | string[], member: Member | string, country: string | null) {\n        const finalPrices = prices.map(price => typeof price === 'string' ? price : price.id)\n        const finalDiscounts = discounts.map(discount => typeof discount === 'string' ? discount : discount.id)\n        const finalMember = typeof member === 'string' ? member : member.id\n        return new Element(\n            this.client,\n            '/community/checkout',\n            {\n                prices: finalPrices.join(','),\n                discounts: finalDiscounts.join(','),\n                member: finalMember,\n                country: country ?? undefined\n            }\n        )\n    }\n\n    async getCheckout(prices: ISkuPrice[] | string[], discounts: IDiscount[] | string[], member: Member | string, email: string, country: string | null = null) {\n        const finalPrices = prices.map(price => typeof price === 'string' ? price : price.id)\n        const finalDiscounts = discounts.map(discount => typeof discount === 'string' ? discount : discount.id)\n        const finalMember = typeof member === 'string' ? member : member.id\n        const checkout = await this.client.post('community', '/store/checkout', {\n            prices: finalPrices,\n            discounts: finalDiscounts,\n            member: finalMember,\n            email,\n            country: country ?? undefined\n        })\n        return checkout\n    }\n\n    async claimCheckout(token: string) {\n        const req = await fetch(`${this.client.domain}/checkout/claim`, {\n            headers: {\n                authorization: `Bearer ${token}`\n            },\n            method: 'POST'\n        })\n        if (req.status != 200 && req.status != 201) {\n            throw new Error(`Error claiming checkout: ${req.statusText}`)\n        }\n    }\n\n    billing() {\n        return new Element(this.client, '/billing')\n    }\n\n}"],"mappings":"2EAOA,IAAqBA,EAArB,KAA2B,CAIvB,YAAYC,EAAqB,CAC7B,KAAK,OAASA,CAClB,CAEA,MAAM,IAAIC,EAAmBC,EAAc,CACvC,OAAOC,EAAa,WAAW,KAAK,OAAQ,MAAM,KAAK,OAAO,KAAK,YAAa,cAAe,CAC3F,SAAAF,EACA,IAAAC,CACJ,CAAC,CAAC,CACN,CAEA,MAAM,mBAAoB,CACtB,GAAM,CAAE,MAAAE,CAAM,EAAI,MAAM,KAAK,OAAO,IAAI,YAAa,qBAAqB,EAC1E,OAAOA,CACX,CAEA,SAASC,EAAgCC,EAAmCC,EAAyBC,EAAwB,CACzH,IAAMC,EAAcJ,EAAO,IAAIK,GAAS,OAAOA,GAAU,SAAWA,EAAQA,EAAM,EAAE,EAC9EC,EAAiBL,EAAU,IAAIM,GAAY,OAAOA,GAAa,SAAWA,EAAWA,EAAS,EAAE,EAChGC,EAAc,OAAON,GAAW,SAAWA,EAASA,EAAO,GACjE,OAAO,IAAIO,EACP,KAAK,OACL,sBACA,CACI,OAAQL,EAAY,KAAK,GAAG,EAC5B,UAAWE,EAAe,KAAK,GAAG,EAClC,OAAQE,EACR,QAASL,GAAW,MACxB,CACJ,CACJ,CAEA,MAAM,YAAYH,EAAgCC,EAAmCC,EAAyBQ,EAAeP,EAAyB,KAAM,CACxJ,IAAMC,EAAcJ,EAAO,IAAIK,GAAS,OAAOA,GAAU,SAAWA,EAAQA,EAAM,EAAE,EAC9EC,EAAiBL,EAAU,IAAIM,GAAY,OAAOA,GAAa,SAAWA,EAAWA,EAAS,EAAE,EAChGC,EAAc,OAAON,GAAW,SAAWA,EAASA,EAAO,GAQjE,OAPiB,MAAM,KAAK,OAAO,KAAK,YAAa,kBAAmB,CACpE,OAAQE,EACR,UAAWE,EACX,OAAQE,EACR,MAAAE,EACA,QAASP,GAAW,MACxB,CAAC,CAEL,CAEA,MAAM,cAAcQ,EAAe,CAC/B,IAAMC,EAAM,MAAM,MAAM,GAAG,KAAK,OAAO,MAAM,kBAAmB,CAC5D,QAAS,CACL,cAAe,UAAUD,CAAK,EAClC,EACA,OAAQ,MACZ,CAAC,EACD,GAAIC,EAAI,QAAU,KAAOA,EAAI,QAAU,IACnC,MAAM,IAAI,MAAM,4BAA4BA,EAAI,UAAU,EAAE,CAEpE,CAEA,SAAU,CACN,OAAO,IAAIH,EAAQ,KAAK,OAAQ,UAAU,CAC9C,CAEJ","names":["Store","client","username","eid","StoreDisplay","count","prices","discounts","member","country","finalPrices","price","finalDiscounts","discount","finalMember","Element","email","token","req"]}