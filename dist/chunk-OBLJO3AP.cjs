"use strict";Object.defineProperty(exports, "__esModule", {value: true});var _chunk3YNQTTHIcjs = require('./chunk-3YNQTTHI.cjs');var _chunkMY3MB4KCcjs = require('./chunk-MY3MB4KC.cjs');var _chunkFXVJCHR6cjs = require('./chunk-FXVJCHR6.cjs');var _nonsecure = require('nanoid/non-secure');var n=class n{constructor(t,s,i){this.clientId=t,this.clientSecret=s,this.test=i}static get(t,s,i=!1){return(!n.instance||n.instance.clientId!==t||n.instance.clientSecret!==s||n.instance.test!==i)&&(n.instance=new n(t,s,i)),n.instance}get store(){return new (0, _chunkMY3MB4KCcjs.a)(this)}get voting(){return new (0, _chunk3YNQTTHIcjs.a)(this)}async member(t){return _chunkFXVJCHR6cjs.a.fromObject(this,await this.post("community","/member/search",t))}get domain(){return this.test?"https://dev.serverbench.io":"https://api.beta.serverbench.io"}async fetch(t,s,i){let a=new Headers({authorization:`ApiKey ${this.clientSecret}`});i&&a.set("Content-Type","application/json");let e=await fetch(`${this.domain}/${t}/${this.clientId}${s}`,{headers:a,method:i?"POST":"GET",body:i?JSON.stringify(i):void 0});if(e.status<200||e.status>=300)throw new Error(e.statusText);return e.json()}rid(){return _nonsecure.nanoid.call(void 0, )}socket(t,s=a=>{},i=!1){let a=this.test?"ws://localhost:3030":"wss://live.beta.serverbench.io",e=new WebSocket(`${a}?${new URLSearchParams({key:this.clientSecret})}`),c=0,o=this.rid();return e.onopen=()=>{c=0,e.send(JSON.stringify({action:`community.${this.clientId}.${t}`,rid:o}))},e.onmessage=p=>{let r=JSON.parse(p.data);if(r.result!=null&&(Array.isArray(r.result)&&r.result.length||Object.keys(r.result).length>0)&&r.rid==o)s(r.result);else{let l=[r.realm];r.realm=="community"&&l.push(this.clientId),l.push(r.action),o=this.rid(),e.send(JSON.stringify({action:l.join("."),rid:o}))}},i||(e.onclose=()=>{c++,setTimeout(()=>{e=this.socket(t,s,!0).ws},Math.min(1e3*c*5,30*1e3))}),{dispose:()=>{e.onclose=null,e.close()},ws:e}}async get(t,s){return this.fetch(t,s)}async post(t,s,i={}){return this.fetch(t,s,i)}};n.instance=null;var h=n;exports.a = h;
//# sourceMappingURL=chunk-OBLJO3AP.cjs.map