var S=()=>typeof window<"u",A=()=>window.self!==window.top,p=e=>e instanceof HTMLIFrameElement,H=e=>{window.document.readyState==="complete"?e():window.addEventListener("load",e)},T=(e,t)=>{t(),e.addEventListener("load",t)},D=(e,t)=>{var n,r;let s=((n=e.contentWindow)==null?void 0:n.document.readyState)==="complete";return e.src!=="about:blank"&&((r=e.contentWindow)==null?void 0:r.location.href)!=="about:blank"&&s?t():e.addEventListener("load",t)},O=()=>({offsetSize:0,checkOrigin:!0,enableLegacyLibSupport:!1}),P=e=>{try{return new URL(e.src).origin===window.location.origin}catch{return!1}},x=e=>{try{let t=new URL(e.src).origin;if(t!=="about:blank")return t}catch{}return null},C=e=>(Object.keys(e).forEach(t=>e[t]===void 0&&delete e[t]),e),L=e=>{let{height:t,width:n}=e.getBoundingClientRect();return{height:Math.ceil(t),width:Math.ceil(n)}},g=(e,t)=>e?t?e.querySelector(t):e.documentElement:null,k=(e,t)=>{e&&(t.bodyPadding&&(e.body.style.padding=t.bodyPadding),t.bodyMargin&&(e.body.style.margin=t.bodyMargin))},h=e=>e<=100?100:e<=120?1e3:1e4,B=()=>"[iFrameSizer]ID:0:false:false:32:true:true::auto:::0:false:child:auto:true:::true:::false";function F(e){if(typeof e.data=="string"&&e.data.startsWith("[iFrameSizer]")){let[t,n]=e.data.split(":"),r=+n;return r>0?r:null}return null}var w=K(),u=[],z=(e,t)=>{if(!S())return[];let n={...O(),...C(e??{})},r=W(t),s=q(n,r);return r.map(i=>{let o={iframe:i,settings:n,interactionState:{isHovered:!1},initContext:{isInitialized:!1,retryAttempts:0}},a=U(o,s);return u.push(o),{unsubscribe:()=>{a(),u=u.filter(d=>d.iframe!==i)}}})};function W(e){return typeof e=="string"?Array.from(document.querySelectorAll(e)).filter(p):e?p(e)?[e]:[]:Array.from(document.getElementsByTagName("iframe"))}function q(e,t){if(Array.isArray(e.checkOrigin))return e.checkOrigin;if(!e.checkOrigin)return[];let n=[];for(let r of t){let s=x(r);s&&n.push(s)}return n}function U(e,t){let n=P(e.iframe)?j(e):$(e,t),r=G(e);return()=>{n(),r()}}function $(e,t){let{iframe:n,initContext:r,settings:{checkOrigin:s,enableLegacyLibSupport:i,targetElementSelector:o,bodyPadding:a,bodyMargin:d}}=e,v=c=>{var b;let I=!s||t.includes(c.origin);if(!(n.contentWindow!==c.source||!I)){if(((b=c.data)==null?void 0:b.type)==="iframe-resized"){let{height:l}=c.data;l&&f({newHeight:l,registeredElement:e});return}if(i){let l=F(c);l!==null&&f({newHeight:l,registeredElement:e});return}}};window.addEventListener("message",v);let M=i?B():{type:"iframe-child-init",targetElementSelector:o,bodyPadding:a,bodyMargin:d},y=()=>{T(n,()=>{var c;return(c=n.contentWindow)==null?void 0:c.postMessage(M,"*")}),r.retryAttempts++,r.retryTimeoutId=window.setTimeout(y,h(r.retryAttempts))};return y(),()=>window.removeEventListener("message",v)}function j(e){let{iframe:t,settings:n}=e,{targetElementSelector:r}=n,s=0,i=()=>{let o=g(t.contentDocument,r);if(!t.contentDocument||!o)return s++,setTimeout(i,h(s));k(t.contentDocument,n),w().observe(o)};return D(t,i),()=>{let o=g(t.contentDocument,r);o&&w().unobserve(o),t.removeEventListener("load",i)}}function G({iframe:e,interactionState:t}){let n=()=>{t.isHovered=!0},r=()=>{t.isHovered=!1};return e.addEventListener("mouseenter",n),e.addEventListener("mouseleave",r),()=>{e.removeEventListener("mouseenter",n),e.removeEventListener("mouseleave",r)}}function K(){let e=null;return()=>{if(!e){let t=({target:n})=>{let r=u.find(({iframe:d})=>d.contentDocument===n.ownerDocument);if(!r)return;let{iframe:s,settings:i}=r,o=g(s.contentDocument,i.targetElementSelector);if(!o)return;let{height:a}=L(o);a&&f({newHeight:a,registeredElement:r})};e=new ResizeObserver(n=>n.forEach(t))}return e}}function f({registeredElement:e,newHeight:t}){let{iframe:n,settings:r,interactionState:s,initContext:i}=e;i.isInitialized||(i.isInitialized=!0,clearTimeout(i.retryTimeoutId));let o=n.getBoundingClientRect(),a=t+r.offsetSize;if(n.style.height=`${a}px`,!r.onIframeResize)return;let d={iframe:n,settings:{...r},interactionState:{...s},previousRenderState:{rect:o},nextRenderState:{rect:n.getBoundingClientRect()}};r.onIframeResize(d)}var Q=Y(),E=!1;V();function V(){!S()||!A()||window.addEventListener("message",e=>{var t;((t=e.data)==null?void 0:t.type)==="iframe-child-init"&&H(()=>R(e))})}function R(e,t=0){let{targetElementSelector:n,bodyPadding:r,bodyMargin:s}=e.data,i=g(document,n);if(E||window.parent!==e.source)return;if(!i)return setTimeout(()=>R(e,t+1),h(t));k(document,{bodyMargin:s,bodyPadding:r});let o=Q();o.disconnect(),o.observe(i),E=!0}function Y(){let e=null;return()=>(e||(e=new ResizeObserver(t=>{if(!t[0].target)return;let{height:n,width:r}=L(t[0].target),s={type:"iframe-resized",width:r,height:n};window.parent.postMessage(s,"*")})),e)}var m=class{constructor(t,n,r={},s=!1,i=!1){this.eventListeners={};this.client=t,this.dark=s,this.background=i,this.path=n,this.args=r,window.addEventListener("message",this.handleMessage.bind(this))}setDark(t){return this.dark=t,this}setBackground(t){return this.background=t,this}async mount(t){let n=new URLSearchParams;n.set("clientId",this.client.clientId),n.set("clientSecret",this.client.clientSecret),n.set("origin",window.location.href),n.set("allow","payment"),this.client.test&&n.set("test","true"),this.dark&&n.set("dark","true"),this.background&&n.set("background","true");for(let i in this.args){let o=this.args[i];Array.isArray(o)?o.length>0&&n.set(i,o.join(",")):o!=null&&n.set(i,o)}t.innerHTML="";let r=document.createElement("iframe");r.src=`https://safe.serverbench.io${this.path}?${n.toString()}`,r.style.width="100%",r.style.height="0",r.style.border="none",r.style.overflowY="hidden",r.frameBorder="0";let s=t.appendChild(r);return z({},s),this}handleMessage(t){if(t.origin!=="https://safe.serverbench.io")return;let n=t.data;n.from==="serverbench"&&n.event&&this.triggerEvent(n.event)}triggerEvent(t){let n=this.eventListeners[t];n&&n.forEach(r=>r())}addEventListener(t,n){return this.eventListeners[t]||(this.eventListeners[t]=[]),this.eventListeners[t].push(n),this}};export{m as a};
//# sourceMappingURL=chunk-BWC56A5D.js.map